{% extends 'base.html' %}
{% block title %}Portfolio - AI Trading Platform{% endblock %}
{% block extra_css %}
<link rel="stylesheet" href="/static/css/dashboard.css">
<style>
    .portfolio-header {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 20px;
        margin-bottom: 24px;
    }

    .portfolio-value-card {
        background: var(--accent-gradient);
        border-radius: 20px;
        padding: 32px;
        color: white;
        position: relative;
        overflow: hidden;
    }

    .portfolio-value-card::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -20%;
        width: 200px;
        height: 200px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
    }

    .pv-label {
        font-size: 14px;
        opacity: 0.9;
        margin-bottom: 8px;
    }

    .pv-value {
        font-size: 36px;
        font-weight: 800;
    }

    .pv-change {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        margin-top: 12px;
        padding: 6px 12px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 100px;
        font-size: 13px;
        font-weight: 600;
    }

    .balance-card {
        background: var(--bg-card);
        border-radius: 20px;
        padding: 24px;
        border: 1px solid var(--border);
    }

    .balance-label {
        font-size: 13px;
        color: var(--text-secondary);
        margin-bottom: 8px;
    }

    .balance-value {
        font-size: 24px;
        font-weight: 700;
    }

    .balance-sub {
        font-size: 13px;
        color: var(--text-muted);
        margin-top: 4px;
    }

    .holdings-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 20px;
    }

    .holding-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 16px;
        background: var(--bg-primary);
        border-radius: 14px;
        margin-bottom: 12px;
        transition: all 0.2s;
    }

    .holding-item:hover {
        transform: translateX(4px);
        background: rgba(99, 102, 241, 0.08);
    }

    .holding-info {
        display: flex;
        align-items: center;
        gap: 14px;
    }

    .holding-icon {
        width: 44px;
        height: 44px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        color: white;
        font-size: 14px;
    }

    .holding-icon.btc {
        background: linear-gradient(135deg, #f7931a, #ffb84d);
    }

    .holding-icon.eth {
        background: linear-gradient(135deg, #627eea, #8b9ff7);
    }

    .holding-icon.sol {
        background: linear-gradient(135deg, #9945ff, #14f195);
    }

    .holding-icon.bnb {
        background: linear-gradient(135deg, #f3ba2f, #f7d571);
    }

    .holding-name {
        font-weight: 600;
    }

    .holding-amount {
        font-size: 13px;
        color: var(--text-secondary);
        margin-top: 2px;
    }

    .holding-value {
        text-align: right;
    }

    .holding-price {
        font-weight: 600;
    }

    .holding-change {
        font-size: 13px;
        margin-top: 2px;
    }

    .holding-change.positive {
        color: var(--success);
    }

    .holding-change.negative {
        color: var(--danger);
    }

    .allocation-chart {
        height: 250px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
</style>
{% endblock %}

{% block content %}
<div class="bg-gradient"></div>
<button class="mobile-menu-toggle" id="mobile-menu-toggle"><i class="fas fa-bars"></i></button>
<aside class="sidebar" id="sidebar">
    <div class="logo">
        <div class="logo-icon">ðŸ“ˆ</div><span class="logo-text">AI Trading</span>
    </div>
    <nav class="nav-section">
        <div class="nav-section-title">Main</div>
        <a href="/" class="nav-item"><i class="fas fa-home"></i><span>Home</span></a>
        <a href="/dashboard/" class="nav-item"><i class="fas fa-chart-line"></i><span>Dashboard</span></a>
        <a href="/portfolio/" class="nav-item active"><i class="fas fa-wallet"></i><span>Portfolio</span></a>
        <a href="/trading/" class="nav-item"><i class="fas fa-exchange-alt"></i><span>Trading</span></a>
        <a href="/market/" class="nav-item"><i class="fas fa-globe"></i><span>Market</span></a>
    </nav>
    <nav class="nav-section">
        <div class="nav-section-title">AI Features</div><a href="/agents/" class="nav-item"><i
                class="fas fa-robot"></i><span>AI Agents</span></a><a href="/predictions/" class="nav-item"><i
                class="fas fa-brain"></i><span>Predictions</span></a><a href="/backtest/" class="nav-item"><i
                class="fas fa-history"></i><span>Backtest</span></a><a href="/risk/" class="nav-item"><i
                class="fas fa-shield-alt"></i><span>Risk</span></a>
    </nav>
    <nav class="nav-section" style="margin-top:auto"><a href="/settings/" class="nav-item"><i
                class="fas fa-cog"></i><span>Settings</span></a><a href="/logout/" class="nav-item"><i
                class="fas fa-sign-out-alt"></i><span>Logout</span></a></nav>
</aside>

<main class="main-content">
    <header class="header">
        <div class="header-left">
            <h1>Portfolio</h1>
            <p>Manage your crypto holdings</p>
        </div>
        <div class="header-right"><button class="btn btn-secondary"><i
                    class="fas fa-download"></i><span>Export</span></button><button class="btn btn-primary"
                onclick="location.href='/trading/'"><i class="fas fa-plus"></i><span>Add Funds</span></button></div>
    </header>

    <div class="portfolio-header">
        <div class="portfolio-value-card">
            <div class="pv-label">Total Portfolio Value</div>
            <div class="pv-value">$12,547.83</div>
            <div class="pv-change"><i class="fas fa-arrow-up"></i>+$2,547.83 (25.48%)</div>
        </div>
        <div class="balance-card">
            <div class="balance-label">Available Balance</div>
            <div class="balance-value">$3,421.56</div>
            <div class="balance-sub">Ready to trade</div>
        </div>
        <div class="balance-card">
            <div class="balance-label">In Orders</div>
            <div class="balance-value">$856.32</div>
            <div class="balance-sub">4 open orders</div>
        </div>
    </div>

    <div class="holdings-grid">
        <div class="card">
            <div class="card-header">
                <h2 class="card-title"><i class="fas fa-coins"></i> Holdings</h2>
            </div>
            <div class="holding-item">
                <div class="holding-info">
                    <div class="holding-icon btc">BTC</div>
                    <div>
                        <div class="holding-name">Bitcoin</div>
                        <div class="holding-amount">0.1523 BTC</div>
                    </div>
                </div>
                <div class="holding-value">
                    <div class="holding-price">$6,628.42</div>
                    <div class="holding-change positive">+2.34%</div>
                </div>
            </div>
            <div class="holding-item">
                <div class="holding-info">
                    <div class="holding-icon eth">ETH</div>
                    <div>
                        <div class="holding-name">Ethereum</div>
                        <div class="holding-amount">1.2341 ETH</div>
                    </div>
                </div>
                <div class="holding-value">
                    <div class="holding-price">$3,275.28</div>
                    <div class="holding-change negative">-1.21%</div>
                </div>
            </div>
            <div class="holding-item">
                <div class="holding-info">
                    <div class="holding-icon sol">SOL</div>
                    <div>
                        <div class="holding-name">Solana</div>
                        <div class="holding-amount">15.45 SOL</div>
                    </div>
                </div>
                <div class="holding-value">
                    <div class="holding-price">$1,526.04</div>
                    <div class="holding-change positive">+5.67%</div>
                </div>
            </div>
            <div class="holding-item">
                <div class="holding-info">
                    <div class="holding-icon bnb">BNB</div>
                    <div>
                        <div class="holding-name">Binance Coin</div>
                        <div class="holding-amount">3.58 BNB</div>
                    </div>
                </div>
                <div class="holding-value">
                    <div class="holding-price">$1,118.09</div>
                    <div class="holding-change positive">+0.89%</div>
                </div>
            </div>
        </div>
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Allocation</h2>
            </div>
            <div class="allocation-chart"><canvas id="allocationChart"></canvas></div>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <h2 class="card-title">Performance History</h2>
            <div class="time-filter"><button class="time-filter-btn">7D</button><button
                    class="time-filter-btn active">30D</button><button class="time-filter-btn">90D</button><button
                    class="time-filter-btn">1Y</button></div>
        </div>
        <div class="chart-container" style="height:300px"><canvas id="performanceChart"></canvas></div>
    </div>
</main>

<script src="/static/js/dashboard.js"></script>
<script>
    document.getElementById('mobile-menu-toggle')?.addEventListener('click', () => document.getElementById('sidebar').classList.toggle('active'));

    const allocCtx = document.getElementById('allocationChart')?.getContext('2d');
    if (allocCtx) {
        new Chart(allocCtx, {
            type: 'doughnut',
            data: { labels: ['BTC', 'ETH', 'SOL', 'BNB'], datasets: [{ data: [52.8, 26.1, 12.2, 8.9], backgroundColor: ['#f7931a', '#627eea', '#9945ff', '#f3ba2f'] }] },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { color: '#9ca3af', padding: 16 } } }, cutout: '70%' }
        });
    }

    const perfCtx = document.getElementById('performanceChart')?.getContext('2d');
    if (perfCtx) {
        const gradient = perfCtx.createLinearGradient(0, 0, 0, 300);
        gradient.addColorStop(0, 'rgba(99, 102, 241, 0.3)');
        gradient.addColorStop(1, 'rgba(99, 102, 241, 0.0)');
        const data = []; let val = 10000;
        for (let i = 0; i < 30; i++) { val *= 1 + (Math.random() - 0.45) * 0.03; data.push(val); }
        new Chart(perfCtx, {
            type: 'line',
            data: { labels: Array.from({ length: 30 }, (_, i) => `Day ${i + 1}`), datasets: [{ data, fill: true, backgroundColor: gradient, borderColor: '#6366f1', borderWidth: 2, tension: 0.4, pointRadius: 0 }] },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { grid: { display: false }, ticks: { color: '#6b7280' } }, y: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#6b7280', callback: v => `$${(v / 1000).toFixed(1)}k` } } } }
        });
    }
</script>
{% endblock %}